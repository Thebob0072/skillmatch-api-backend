# üí∞ Financial System Documentation

## üìã ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô

‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á SkillMatch ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢:
- üí≥ **‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô** - Stripe Integration
- üí∞ **‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô (Wallet)** - ‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
- üè¶ **‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£** - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
- üìä **‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° (Transactions)** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÄ‡∏á‡∏¥‡∏ô
- üí∏ **‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (Withdrawals)** - ‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
- üìà **‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô** - ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ/‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢

---

## üíµ ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (Total 12.75%):
```
‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢): 1,000 ‡∏ö‡∏≤‡∏ó
‚îú‚îÄ‚îÄ Payment Gateway (Stripe 2.75%): 27.5 ‡∏ö‡∏≤‡∏ó
‚îú‚îÄ‚îÄ Platform Commission (10%): 100 ‡∏ö‡∏≤‡∏ó
‚îî‚îÄ‚îÄ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ Provider (87.25%): 872.5 ‡∏ö‡∏≤‡∏ó
```

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:**
- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏° (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°)
- Provider ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô 87.25% (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏£‡∏ß‡∏° 12.75%)
- ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ù‡∏±‡πà‡∏á Provider

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°:

**1. ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Provider ‡∏™‡∏£‡πâ‡∏≤‡∏á Account:**
```
‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°

‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏£‡∏ß‡∏° 12.75% ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:

üìä ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°:
‚Ä¢ Payment Gateway (Stripe): 2.75%
‚Ä¢ Platform Commission: 10.00%
‚Ä¢ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 12.75%

‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: 87.25% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢: 1,000 ‡∏ö‡∏≤‡∏ó
- ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: 872.50 ‡∏ö‡∏≤‡∏ó
- ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°: 127.50 ‡∏ö‡∏≤‡∏ó

‚úÖ ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
```

**2. ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Dashboard Provider:**
- ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 12.75%)
- ‡πÅ‡∏™‡∏î‡∏á breakdown ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
- ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:

| ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ | Stripe (2.75%) | Platform (10%) | ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (12.75%) | ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ Provider (87.25%) |
|-----------|----------------|----------------|--------------------------|------------------------|
| 500 ‡∏ö‡∏≤‡∏ó   | 13.75 ‡∏ö‡∏≤‡∏ó      | 50 ‡∏ö‡∏≤‡∏ó         | 63.75 ‡∏ö‡∏≤‡∏ó                | 436.25 ‡∏ö‡∏≤‡∏ó              |
| 1,000 ‡∏ö‡∏≤‡∏ó | 27.50 ‡∏ö‡∏≤‡∏ó      | 100 ‡∏ö‡∏≤‡∏ó        | 127.50 ‡∏ö‡∏≤‡∏ó               | 872.50 ‡∏ö‡∏≤‡∏ó              |
| 2,000 ‡∏ö‡∏≤‡∏ó | 55.00 ‡∏ö‡∏≤‡∏ó      | 200 ‡∏ö‡∏≤‡∏ó        | 255.00 ‡∏ö‡∏≤‡∏ó               | 1,745.00 ‡∏ö‡∏≤‡∏ó            |
| 5,000 ‡∏ö‡∏≤‡∏ó | 137.50 ‡∏ö‡∏≤‡∏ó     | 500 ‡∏ö‡∏≤‡∏ó        | 637.50 ‡∏ö‡∏≤‡∏ó               | 4,362.50 ‡∏ö‡∏≤‡∏ó            |

**‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:**
```
‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ = X ‡∏ö‡∏≤‡∏ó
‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° Stripe = X √ó 0.0275
‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° = X √ó 0.10
‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° = X √ó 0.1275
‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ Provider = X √ó 0.8725 (‡∏´‡∏£‡∏∑‡∏≠ X - (X √ó 0.1275))
```

### Flow ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô:

```
‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢ 1,000 ‡∏ö‡∏≤‡∏ó (‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°)
    ‚Üì
Stripe Payment Gateway
    ‚îú‚îÄ‚îÄ Stripe ‡∏´‡∏±‡∏Å 2.75% = 27.5 ‡∏ö‡∏≤‡∏ó
    ‚îî‚îÄ‚îÄ ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 972.5 ‡∏ö‡∏≤‡∏ó
    ‚Üì
‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏£‡∏ß‡∏° 12.75%:
    ‚îú‚îÄ‚îÄ Payment Gateway Fee: 2.75% (27.5 ‡∏ö‡∏≤‡∏ó)
    ‚îú‚îÄ‚îÄ Platform Commission: 10% (100 ‡∏ö‡∏≤‡∏ó)
    ‚îî‚îÄ‚îÄ ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°: 12.75% (127.5 ‡∏ö‡∏≤‡∏ó)
    ‚Üì
Provider ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:
    ‚îú‚îÄ‚îÄ 1,000 - 127.5 = 872.5 ‡∏ö‡∏≤‡∏ó
    ‚îî‚îÄ‚îÄ ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Pending Balance (‡∏£‡∏≠ 7 ‡∏ß‡∏±‡∏ô)
    ‚Üì
‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô ‚Üí Available Balance (872.5 ‡∏ö‡∏≤‡∏ó)
    ‚Üì
Provider ‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô
    ‚Üì
GOD ‡πÇ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° 872.5 ‡∏ö‡∏≤‡∏ó
    ‚Üì
‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô (‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GOD):
    ‚îú‚îÄ‚îÄ WebSocket ‚Üí Chat ‡πÅ‡∏ö‡∏ö real-time
    ‚îú‚îÄ‚îÄ Email ‚Üí ‡∏™‡πà‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏° PDF ‡∏™‡∏•‡∏¥‡∏õ
    ‚îî‚îÄ‚îÄ ‡∏´‡∏ô‡πâ‡∏≤ Withdrawals ‚Üí ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î slip
```

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏° 1,000 ‡∏ö‡∏≤‡∏ó (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°)
- Provider ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 872.5 ‡∏ö‡∏≤‡∏ó (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 12.75% ‡πÅ‡∏•‡πâ‡∏ß)
- GOD ‡πÄ‡∏Å‡πá‡∏ö 100 ‡∏ö‡∏≤‡∏ó (10%) + Stripe ‡∏´‡∏±‡∏Å 27.5 ‡∏ö‡∏≤‡∏ó (2.75%)

---

## üóÑÔ∏è Database Tables

### 1. bank_accounts - ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£

```sql
- bank_account_id (PK)
- user_id (FK ‚Üí users)
- bank_name (VARCHAR): "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢"
- bank_code: "KBANK"
- account_number: "1234567890"
- account_name: "‡∏ô‡∏≤‡∏¢ ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ"
- account_type: savings | current
- is_verified: BOOLEAN (‡∏ï‡πâ‡∏≠‡∏á verify ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô)
- is_default: BOOLEAN
- is_active: BOOLEAN
```

**Key Points:**
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
- ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Admin (is_verified=true) ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
- ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö KYC

---

### 2. wallets - ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô

```sql
- wallet_id (PK)
- user_id (FK ‚Üí users, UNIQUE)
- available_balance: ‡∏¢‡∏≠‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡∏≠‡∏ô
- pending_balance: ‡∏¢‡∏≠‡∏î‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (booking ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠ 7 ‡∏ß‡∏±‡∏ô)
- total_earned: ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- total_withdrawn: ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- total_commission_paid: ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ
```

**Business Logic:**
- **Pending Balance**: ‡πÄ‡∏°‡∏∑‡πà‡∏≠ booking ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤ pending_balance ‡∏£‡∏≠ 7 ‡∏ß‡∏±‡∏ô
- **Available Balance**: ‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ available_balance (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡∏≠‡∏ô)
- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏â‡πâ‡∏≠‡πÇ‡∏Å‡∏á/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£

---

### 3. transactions - ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°

```sql
- transaction_id (PK)
- transaction_uuid (UUID, UNIQUE)
- user_id (FK ‚Üí users)
- related_user_id: ‡∏Ñ‡∏π‡πà‡∏Å‡∏£‡∏ì‡∏µ (‡πÄ‡∏ä‡πà‡∏ô provider ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á)
- type: ENUM (booking_payment, commission, provider_earning, withdrawal, etc.)
- status: ENUM (pending, processing, completed, failed, cancelled)
- amount: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô
- commission_amount: ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø
- net_amount: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
- booking_id (FK ‚Üí bookings)
- payment_method: stripe, promptpay, bank_transfer
- payment_intent_id: Stripe Payment Intent ID
```

**Transaction Types:**
- `booking_payment`: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô
- `commission`: ‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
- `provider_earning`: ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤ wallet provider
- `withdrawal`: ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
- `subscription_fee`: ‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
- `admin_adjustment`: admin ‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î
- `bonus`: ‡πÇ‡∏ö‡∏ô‡∏±‡∏™
- `penalty`: ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö

---

### 4. withdrawals - ‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô

```sql
- withdrawal_id (PK)
- withdrawal_uuid (UUID)
- user_id (FK)
- bank_account_id (FK)
- requested_amount: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô
- fee: ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (10 ‡∏ö‡∏≤‡∏ó)
- net_amount: ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á
- status: pending | approved | processing | completed | rejected | failed
- requested_at, approved_at, completed_at
- approved_by: admin ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
- transfer_reference: ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô
- rejection_reason: ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
```

**Withdrawal Flow:**
```
1. Provider ‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô ‚Üí status: pending
2. Admin ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‚Üí approve/reject
3. ‡∏ñ‡πâ‡∏≤ approve ‚Üí status: approved
4. GOD/Admin ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° ‚Üí status: processing
   - ‡πÇ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å: ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ GOD (Platform Bank Account)
   - ‡πÇ‡∏≠‡∏ô‡πÑ‡∏õ: ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á Provider
   - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á + ‡∏™‡∏•‡∏¥‡∏õ + ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å
5. ‡πÇ‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Üí status: completed (+ slip URL + transfer reference)
```

**Platform Bank Account (GOD Account):**
- ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÇ‡∏î‡∏¢ GOD)
- ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ
- ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö audit ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏©‡∏µ
- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏â‡πâ‡∏≠‡πÇ‡∏Å‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ transparency

---

### 5. commission_rules - ‡∏Å‡∏é‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô

```sql
- rule_id (PK)
- name: "Default Platform Commission"
- platform_rate: 0.1000 (10%)
- payment_gateway_rate: 0.0275 (2.75% Stripe)
- tier_id: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö tier ‡∏û‡∏¥‡πÄ‡∏®‡∏© (optional)
- effective_from, effective_until
- is_active: BOOLEAN
```

**Use Case:**
- ‡πÅ‡∏¢‡∏Å rate ‡∏ï‡∏≤‡∏° tier (Premium tier ‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤)
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô rate ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÑ‡∏î‡πâ (effective_from)

---

### 6. financial_reports - ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô

```sql
- report_id (PK)
- report_type: daily | weekly | monthly | yearly
- period_start, period_end
- total_bookings: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô booking
- total_revenue: ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°
- total_commission: ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø ‡∏£‡∏ß‡∏°
- total_provider_earnings: ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ provider ‡∏£‡∏ß‡∏°
- total_withdrawals: ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°
- total_subscriptions: ‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏£‡∏ß‡∏°
- breakdown: JSONB (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° category, tier)
- generated_by: admin ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á
```

---

## üîÑ Business Flow Examples

### 1. Customer ‡∏à‡∏≠‡∏á Provider

```sql
-- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≠‡∏á booking_id=123, ‡∏£‡∏≤‡∏Ñ‡∏≤ 1,000 ‡∏ö‡∏≤‡∏ó
BEGIN TRANSACTION;

-- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á booking (‡πÉ‡∏ô booking_handlers.go)
INSERT INTO bookings (...) VALUES (...);

-- 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å transaction: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢
INSERT INTO transactions (
    user_id,                    -- customer_id
    related_user_id,            -- provider_id
    type,                       -- 'booking_payment'
    amount,                     -- 1000
    commission_amount,          -- 100 (10%)
    net_amount,                 -- 900
    booking_id,                 -- 123
    payment_intent_id           -- Stripe ID
) VALUES (...);

-- 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å commission ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
INSERT INTO transactions (
    type,                       -- 'commission'
    amount,                     -- 100
    description                 -- 'Platform commission 10%'
) VALUES (...);

-- 4. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ pending_balance ‡∏Ç‡∏≠‡∏á provider
UPDATE wallets
SET pending_balance = pending_balance + 900,
    total_earned = total_earned + 900,
    total_commission_paid = total_commission_paid + 100
WHERE user_id = provider_id;

-- 5. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å provider earning
INSERT INTO transactions (
    user_id,                    -- provider_id
    type,                       -- 'provider_earning'
    amount,                     -- 900
    status,                     -- 'pending'
    booking_id                  -- 123
) VALUES (...);

COMMIT;
```

### 2. ‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô: ‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å Pending ‚Üí Available

```sql
-- Cron Job ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
BEGIN TRANSACTION;

-- ‡∏´‡∏≤ transactions ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô 7 ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß
UPDATE transactions
SET status = 'completed'
WHERE type = 'provider_earning'
  AND status = 'pending'
  AND created_at < NOW() - INTERVAL '7 days';

-- ‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô pending ‚Üí available
UPDATE wallets w
SET available_balance = available_balance + (
    SELECT COALESCE(SUM(net_amount), 0)
    FROM transactions t
    WHERE t.user_id = w.user_id
      AND t.type = 'provider_earning'
      AND t.status = 'completed'
      AND t.processed_at IS NULL
),
pending_balance = pending_balance - (
    SELECT COALESCE(SUM(net_amount), 0)
    FROM transactions t
    WHERE t.user_id = w.user_id
      AND t.type = 'provider_earning'
      AND t.status = 'completed'
      AND t.processed_at IS NULL
);

-- Mark transactions as processed
UPDATE transactions
SET processed_at = NOW()
WHERE type = 'provider_earning'
  AND status = 'completed'
  AND processed_at IS NULL;

COMMIT;
```

### 3. Provider ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô

```sql
-- Provider ‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô 1,000 ‡∏ö‡∏≤‡∏ó
BEGIN TRANSACTION;

-- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á withdrawal request
INSERT INTO withdrawals (
    user_id, bank_account_id, 
    requested_amount, fee, net_amount, status
) VALUES (
    provider_id, bank_acc_id,
    1000, 10, 990, 'pending'
);

-- 2. ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å available_balance
UPDATE wallets
SET available_balance = available_balance - 1000
WHERE user_id = provider_id;

-- 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á transaction
INSERT INTO transactions (
    user_id, type, amount, commission_amount, net_amount,
    withdrawal_id, description
) VALUES (
    provider_id, 'withdrawal', 1000, 10, 990,
    withdrawal_id, 'Withdrawal request #...'
);

COMMIT;
```

### 4. Admin Approve & Complete Withdrawal (via Platform Bank)

```sql
BEGIN TRANSACTION;

-- 1. Admin ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
UPDATE withdrawals
SET status = 'approved',
    approved_at = NOW(),
    approved_by = admin_id
WHERE withdrawal_id = xxx;

-- 2. GOD ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 90% ‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° (10% ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß)
-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô
UPDATE withdrawals
SET status = 'completed',
    completed_at = NOW(),
    transfer_reference = 'TXN123456',        -- ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
    transfer_slip_url = 'https://gcs.../slip_masked.jpg', -- ‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GOD
    platform_bank_account_id = god_bank_id,  -- ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å
    platform_transfer_by = god_user_id,      -- GOD ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô
    platform_transfer_timestamp = NOW(),
    notes = 'Transferred 90% to provider (10% platform commission retained)'
WHERE withdrawal_id = xxx;

-- 3. ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó wallet
UPDATE wallets
SET total_withdrawn = total_withdrawn + 900,  -- ‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡∏à‡∏£‡∏¥‡∏á (90%)
    last_updated = NOW()
WHERE user_id = provider_id;

-- 4. ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó transaction
UPDATE transactions
SET status = 'completed', 
    processed_at = NOW(),
    notes = 'Paid via platform bank account - 10% commission withheld'
WHERE withdrawal_id = xxx;

-- 5. ‡∏™‡∏£‡πâ‡∏≤‡∏á transfer log (audit trail)
INSERT INTO withdrawal_transfer_logs (
    withdrawal_id, platform_bank_account_id,
    platform_account_number, platform_account_name,
    provider_account_number, provider_account_name, provider_bank_name,
    transfer_amount, transfer_timestamp, transfer_reference,
    transfer_slip_url, transferred_by, transfer_method
) VALUES (
    xxx, god_bank_id,
    'XXX-X-XXXXX-X', '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó SkillMatch ‡∏à‡∏≥‡∏Å‡∏±‡∏î',  -- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GOD (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô DB)
    'xxx-x-xxxxx-x', '‡∏ô‡∏≤‡∏¢ Provider', '‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢',
    900.00, NOW(), 'TXN123456',
    'https://gcs.../slip_masked.jpg',  -- ‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
    god_user_id, 'mobile_banking'
);

-- 6. ‡∏™‡πà‡∏á Notification
INSERT INTO notifications (
    user_id, notification_type, title, message, 
    related_entity_type, related_entity_id, metadata
) VALUES (
    provider_id, 'withdrawal_completed',
    '‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
    '‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 900 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ xxx-x-xxxxx-x ‡πÅ‡∏•‡πâ‡∏ß',
    'withdrawal', xxx,
    '{"amount": 900, "transfer_ref": "TXN123456", "slip_url": "https://..."}' ::jsonb
);

COMMIT;

-- 7. ‡∏™‡πà‡∏á WebSocket notification (real-time)
-- (‡∏ó‡∏≥‡πÉ‡∏ô Go code)
wsManager.BroadcastToUser(provider_id, {
    "type": "withdrawal_completed",
    "payload": {
        "withdrawal_id": xxx,
        "amount": 900,
        "transfer_reference": "TXN123456",
        "slip_url": "https://gcs.../slip_masked.jpg",  -- ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GOD
        "completed_at": "2025-11-14T10:30:00Z"
    }
})

-- 8. ‡∏™‡πà‡∏á Email ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏•‡∏¥‡∏õ (‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GOD)
-- (‡∏ó‡∏≥‡πÉ‡∏ô Go code - ‡πÉ‡∏ä‡πâ SMTP ‡∏´‡∏£‡∏∑‡∏≠ SendGrid)
sendEmail({
    to: "provider@example.com",
    subject: "‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - SkillMatch",
    body: "‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 900 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß",
    attachments: ["slip_masked.jpg"]  -- ‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
})
```

**Security Benefits:**
- ‚úÖ **Audit Trail**: ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (GOD account) ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ
- ‚úÖ **Fraud Prevention**: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏õ provider
- ‚úÖ **Tax Compliance**: ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ
- ‚úÖ **Fund Control**: GOD ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
- ‚úÖ **Dispute Resolution**: ‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£

---

## üìä Algorithm & Business Rules

### 1. ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏ö‡∏ö Dynamic

```go
// Get commission rule
func getCommissionRate(userID int, tierID *int) (float64, error) {
    var rate float64
    
    if tierID != nil {
        // Check for tier-specific rate
        err := db.QueryRow(`
            SELECT platform_rate FROM commission_rules
            WHERE tier_id = $1 AND is_active = true
              AND effective_from <= CURRENT_DATE
              AND (effective_until IS NULL OR effective_until >= CURRENT_DATE)
            ORDER BY effective_from DESC LIMIT 1
        `, tierID).Scan(&rate)
        
        if err == nil {
            return rate, nil
        }
    }
    
    // Fallback to default rate
    err := db.QueryRow(`
        SELECT platform_rate FROM commission_rules
        WHERE tier_id IS NULL AND is_active = true
        ORDER BY effective_from DESC LIMIT 1
    `).Scan(&rate)
    
    return rate, err
}

// Calculate commission
commissionRate := 0.10 // Default 10%
if rate, err := getCommissionRate(providerID, tierID); err == nil {
    commissionRate = rate
}

totalAmount := 1000.0
commissionAmount := totalAmount * commissionRate
providerEarning := totalAmount - commissionAmount
```

### 2. Algorithm ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Recommendation Provider

```go
// Recommend providers based on earning potential
func recommendProviders(location string, category int, priceRange string) []Provider {
    /*
    Scoring Algorithm:
    - Rating (40%): average_rating * 0.4
    - Availability (30%): available_slots / total_slots * 0.3
    - Price competitiveness (20%): (max_price - provider_price) / max_price * 0.2
    - Response time (10%): 1 - (avg_response_hours / 24) * 0.1
    */
    
    query := `
        SELECT p.user_id, p.username,
               -- Calculate score
               (COALESCE(AVG(r.rating), 0) * 0.4 +
                (COUNT(DISTINCT pa.slot_id)::FLOAT / NULLIF(COUNT(DISTINCT pa.slot_id) + COUNT(DISTINCT b.booking_id), 0)) * 0.3 +
                ((SELECT MAX(price) FROM service_packages) - MIN(sp.price)) / (SELECT MAX(price) FROM service_packages) * 0.2 +
                (1 - (AVG(EXTRACT(EPOCH FROM (m.created_at - m.sent_at)) / 3600) / 24)) * 0.1
               ) as score
        FROM users p
        LEFT JOIN reviews r ON p.user_id = r.provider_id
        LEFT JOIN service_packages sp ON p.user_id = sp.provider_id
        LEFT JOIN provider_availability pa ON p.user_id = pa.provider_id
        LEFT JOIN bookings b ON p.user_id = b.provider_id AND b.status IN ('pending', 'confirmed')
        LEFT JOIN messages m ON p.user_id = m.recipient_id
        WHERE p.verification_status = 'approved'
          AND p.province = ?
          AND EXISTS (
              SELECT 1 FROM provider_categories pc
              WHERE pc.provider_id = p.user_id AND pc.category_id = ?
          )
        GROUP BY p.user_id
        ORDER BY score DESC
        LIMIT 20
    `
    
    // Execute query...
}
```

### 3. Fraud Detection Algorithm

```go
// Detect suspicious withdrawal patterns
func detectSuspiciousWithdrawal(userID int, amount float64) (bool, string) {
    // Rule 1: Withdrawal > 80% of total earned in last 7 days
    var last7DaysEarning float64
    db.QueryRow(`
        SELECT COALESCE(SUM(net_amount), 0)
        FROM transactions
        WHERE user_id = $1 AND type = 'provider_earning'
          AND created_at >= NOW() - INTERVAL '7 days'
    `, userID).Scan(&last7DaysEarning)
    
    if amount > last7DaysEarning * 0.8 {
        return true, "Withdrawal amount exceeds 80% of recent earnings"
    }
    
    // Rule 2: More than 3 withdrawals in 24 hours
    var count24h int
    db.QueryRow(`
        SELECT COUNT(*) FROM withdrawals
        WHERE user_id = $1
          AND requested_at >= NOW() - INTERVAL '24 hours'
    `, userID).Scan(&count24h)
    
    if count24h >= 3 {
        return true, "Too many withdrawal requests in 24 hours"
    }
    
    // Rule 3: First withdrawal > 10,000 THB
    var totalWithdrawals int
    db.QueryRow(`
        SELECT COUNT(*) FROM withdrawals
        WHERE user_id = $1 AND status = 'completed'
    `, userID).Scan(&totalWithdrawals)
    
    if totalWithdrawals == 0 && amount > 10000 {
        return true, "First withdrawal exceeds 10,000 THB"
    }
    
    return false, ""
}
```

---

## üîê Security & Validation

### Bank Account Verification Process

```
1. User ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ ‚Üí is_verified = false
2. Admin ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:
   - ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö KYC?
   - ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á?
   - Test ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 1 ‡∏ö‡∏≤‡∏ó (optional)
3. Admin ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚Üí is_verified = true
4. User ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ
```

### Withdrawal Rules

- ‚úÖ Minimum: 100 ‡∏ö‡∏≤‡∏ó
- ‚úÖ Fee: 10 ‡∏ö‡∏≤‡∏ó ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‚úÖ Bank account ‡∏ï‡πâ‡∏≠‡∏á verified
- ‚úÖ available_balance ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
- ‚úÖ Daily limit: 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ß‡∏±‡∏ô
- ‚úÖ Max per withdrawal: 100,000 ‡∏ö‡∏≤‡∏ó

---

## üì± API Endpoints Summary

### User Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/bank-accounts` | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ |
| GET | `/bank-accounts` | ‡∏î‡∏π‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á |
| DELETE | `/bank-accounts/:id` | ‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ |
| GET | `/wallet` | ‡∏î‡∏π wallet ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á |
| POST | `/withdrawals` | ‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô |
| GET | `/withdrawals` | ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô |
| GET | `/transactions` | ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° |

### Admin Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/admin/withdrawals` | ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| POST | `/admin/withdrawals/:id/process` | ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò/complete |
| POST | `/admin/bank-accounts/:id/verify` | ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ |
| GET | `/admin/financial/summary` | ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ |
| POST | `/admin/financial/report` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô |
| GET | `/admin/commission-rules` | ‡∏î‡∏π‡∏Å‡∏é‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô |
| PUT | `/admin/commission-rules/:id` | ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏é |
| GET | `/admin/wallets/:user_id` | ‡∏î‡∏π wallet user |
| POST | `/admin/wallets/:user_id/adjust` | ‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î (bonus/penalty) |

### GOD Endpoints (Platform Bank Management)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/admin/god/platform-banks` | ‡∏î‡∏π‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| POST | `/admin/god/platform-banks` | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡∏°‡πà |
| PUT | `/admin/god/platform-banks/:id` | ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° |
| POST | `/admin/god/platform-banks/:id/set-default` | ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏´‡∏•‡∏±‡∏Å |
| GET | `/admin/god/transfer-logs` | ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| GET | `/admin/god/transfer-logs/:withdrawal_id` | ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á withdrawal ‡∏ô‡∏µ‡πâ |

---

## üöÄ Implementation Checklist

**Database:**
- [x] Create migration 013
- [x] 6 tables created (bank_accounts, wallets, transactions, withdrawals, commission_rules, financial_reports)
- [x] Indexes for performance
- [x] Default commission rule inserted (10%)

**Backend:**
- [x] financial_models.go - All data models
- [x] financial_handlers.go - User endpoints
- [x] financial_admin_handlers.go - Admin endpoints
- [ ] Update booking_handlers.go - Auto create transactions
- [ ] Update payment_handlers.go - Record subscription transactions
- [ ] Add cron job - Move pending ‚Üí available (7 days)

**Frontend:**
- [ ] Provider Dashboard: Wallet component
- [ ] Provider Settings: Bank account management
- [ ] Provider Finance: Withdrawal request form
- [ ] Admin Panel: Withdrawal approval queue
- [ ] Admin Panel: Financial reports

---

## üìà Next Steps

1. **Integrate with Booking System**
   - ‡πÄ‡∏°‡∏∑‡πà‡∏≠ booking confirmed ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á transactions
   - ‡πÄ‡∏°‡∏∑‡πà‡∏≠ booking completed ‚Üí ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ pending_balance

2. **Cron Jobs**
   - Daily: ‡∏¢‡πâ‡∏≤‡∏¢ pending ‚Üí available (7 days)
   - Daily: Generate daily financial reports
   - Monthly: Send earning statements to providers

3. **Notifications**
   - ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ wallet
   - ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ withdrawal approved/rejected
   - ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡∏≠‡∏ô (pending ‚Üí available)

4. **Dashboard & Analytics**
   - Provider: ‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 30 ‡∏ß‡∏±‡∏ô
   - Admin: Dashboard ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
   - Charts: Booking trends, Popular categories

5. **Advanced Features**
   - Auto-payout: ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå
   - Tax documents: Export ‡∏†‡∏≤‡∏©‡∏µ (‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ø)
   - Referral system: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
   - Loyalty rewards: ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤

---

## üîê Platform Bank Account Security

### GOD Account Requirements
- ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô user ‡∏ó‡∏µ‡πà‡∏°‡∏µ `tier_id = 5` ‡πÅ‡∏•‡∏∞ `is_admin = true`
- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏µ‡πà verified ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô `platform_bank_accounts`
- ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ backup account ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ

### Withdrawal Approval Process
```
1. Provider ‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô 1,000 ‡∏ö‡∏≤‡∏ó ‚Üí withdrawal status: pending
   - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö available_balance
   - ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å wallet ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (lock amount)

2. Admin/GOD ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:
   ‚úì Bank account verified?
   ‚úì Available balance sufficient?
   ‚úì No suspicious patterns?
   ‚úì Provider ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏î‡∏µ‡πÑ‡∏´‡∏°?

3. Admin/GOD ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚Üí status: approved
   - ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ GOD ‡∏°‡∏µ‡∏¢‡∏≠‡∏î 100 ‡∏ö‡∏≤‡∏ó (10% commission)
   - ‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏≠‡∏ô 900 ‡∏ö‡∏≤‡∏ó (90%) ‡πÑ‡∏õ provider

4. GOD ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å platform bank account ‚Üí ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 900 ‡∏ö‡∏≤‡∏ó
   - ‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô mobile banking / internet banking
   - ‡πÑ‡∏î‡πâ‡∏™‡∏•‡∏¥‡∏õ‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ GOD)

5. ‡∏£‡∏∞‡∏ö‡∏ö Process ‡∏™‡∏•‡∏¥‡∏õ:
   - Upload ‡∏™‡∏•‡∏¥‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á GCS (private)
   - ‚úÇÔ∏è **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏•‡∏¥‡∏õ**: Mask/Remove ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GOD
     * ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô ‚Üí "SkillMatch Platform"
     * ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô ‚Üí "XXX-X-XXXXX-X"
     * ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
   - Upload ‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏¢‡∏±‡∏á GCS (public)

6. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
   - transfer_reference (‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£)
   - transfer_slip_url (URL ‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß - ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GOD)
   - platform_bank_account_id (‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å - ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô DB ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
   - platform_transfer_by (GOD user_id)
   - platform_transfer_timestamp

7. ‡∏™‡∏£‡πâ‡∏≤‡∏á audit log ‡πÉ‡∏ô withdrawal_transfer_logs
   - ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GOD ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö internal audit)
   - ‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å public data

8. ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:
   ‚úâÔ∏è **Email**: ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
   üí¨ **Chat/WebSocket**: ‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏ö‡∏ö real-time ‡∏û‡∏£‡πâ‡∏≠‡∏° link ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ
   üîî **Notification**: ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ

9. Status ‚Üí completed
   - Provider ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô 900 ‡∏ö‡∏≤‡∏ó
   - GOD ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô 100 ‡∏ö‡∏≤‡∏ó ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
```

### Audit Trail Benefits
‚úÖ **Transparency**: ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏°‡∏µ log ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô  
‚úÖ **Accountability**: ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡πÇ‡∏≠‡∏ô ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà ‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏´‡∏ô  
‚úÖ **Tax Compliance**: Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ  
‚úÖ **Fraud Detection**: ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢  
‚úÖ **Dispute Resolution**: ‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£  

---

---

## üé≠ Transfer Slip Masking System

### Why Mask Transfer Slips?
- **Privacy**: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ GOD
- **Security**: ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ
- **Professionalism**: Provider ‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà "SkillMatch Platform" ‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß GOD

### Slip Masking Process

```go
// 1. Upload Original Slip (Private)
originalSlipURL := uploadToGCS(slipFile, "transfer-slips/original/")
// URL: gs://bucket/transfer-slips/original/withdrawal_123_original.jpg

// 2. Mask Sensitive Information
maskedSlipFile := maskTransferSlip(slipFile, {
    "senderName": "SkillMatch Platform",         // ‡πÅ‡∏ó‡∏ô‡∏ä‡∏∑‡πà‡∏≠ GOD
    "senderAccount": "XXX-X-XXXXX-X",           // ‡πÅ‡∏ó‡∏ô‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ GOD
    "hideFields": ["branch", "idCard"]          // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
})

// 3. Upload Masked Slip (Public)
maskedSlipURL := uploadToGCS(maskedSlipFile, "transfer-slips/public/")
// URL: https://storage.googleapis.com/.../withdrawal_123_masked.jpg

// 4. Store Both URLs
updateWithdrawal({
    original_slip_url: originalSlipURL,  // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô DB (‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á provider)
    transfer_slip_url: maskedSlipURL     // ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ provider ‡πÄ‡∏´‡πá‡∏ô
})
```

### Masking Rules

| Field | Original | Masked |
|-------|----------|--------|
| ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô | ‡∏ô‡∏≤‡∏¢ GOD Master | **SkillMatch Platform** |
| ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô | 123-4-56789-0 | **XXX-X-XXXXX-X** |
| ‡∏™‡∏≤‡∏Ç‡∏≤ | ‡∏™‡∏µ‡∏•‡∏° | *(‡∏•‡∏ö‡∏≠‡∏≠‡∏Å)* |
| ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô | 1-XXXX-XXXXX-XX-X | *(‡∏•‡∏ö‡∏≠‡∏≠‡∏Å)* |
| ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö | ‡∏ô‡∏≤‡∏¢ Provider | **‡∏ô‡∏≤‡∏¢ Provider** ‚úÖ |
| ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö | 987-6-54321-0 | **987-6-54321-0** ‚úÖ |
| ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô | 900.00 | **900.00** ‚úÖ |
| ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á | TXN123456 | **TXN123456** ‚úÖ |

---

## üìß Notification System for Withdrawals

### 1. WebSocket Notification (Real-time Chat)

```javascript
// Provider ‡∏£‡∏±‡∏ö notification ‡∏ó‡∏≤‡∏á WebSocket
{
    "type": "withdrawal_completed",
    "payload": {
        "withdrawal_id": 123,
        "withdrawal_uuid": "abc-def-ghi",
        "requested_amount": 1000.00,
        "commission": 100.00,        // 10%
        "net_amount": 900.00,        // ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á
        "transfer_reference": "TXN123456",
        "transfer_slip_url": "https://storage.../withdrawal_123_masked.jpg",
        "completed_at": "2025-11-14T10:30:00Z",
        "message": "‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 900 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ xxx-x-xxxxx-x ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"
    }
}
```

**Go Implementation:**
```go
// In financial_admin_handlers.go
func completeWithdrawal(withdrawalID int, slipURL string) {
    // ... update database ...
    
    // Send WebSocket notification
    wsManager.BroadcastToUser(providerID, WebSocketMessage{
        Type: "withdrawal_completed",
        Payload: map[string]interface{}{
            "withdrawal_id":      withdrawalID,
            "net_amount":         netAmount,
            "transfer_slip_url":  maskedSlipURL,  // ‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß
            "message":            "‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        },
    })
}
```

### 2. Email Notification

**Email Template:**

```
‡πÄ‡∏£‡∏µ‡∏¢‡∏ô [Provider Name]

‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß

‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô: 1,000.00 ‡∏ö‡∏≤‡∏ó
- ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°: 10.00 ‡∏ö‡∏≤‡∏ó
- ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° (10%): 100.00 ‡∏ö‡∏≤‡∏ó
- ‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: 900.00 ‡∏ö‡∏≤‡∏ó

‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: TXN123456
‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏≠‡∏ô: 14 ‡∏û.‡∏¢. 2568 ‡πÄ‡∏ß‡∏•‡∏≤ 10:30 ‡∏ô.

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á

‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô: [‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà]

‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ SkillMatch
```

**Go Implementation:**
```go
import "net/smtp"

func sendWithdrawalEmail(providerEmail string, data WithdrawalData) error {
    // Email content with masked slip URL
    body := fmt.Sprintf(`
        ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô %s
        
        ‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
        
        - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô: %.2f ‡∏ö‡∏≤‡∏ó
        - ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: %s
        
        ‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô: %s
    `, data.Name, data.NetAmount, data.Reference, data.MaskedSlipURL)
    
    // Send via SMTP or SendGrid
    return sendEmail(providerEmail, "‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", body)
}
```

### 3. In-App Notification

```sql
INSERT INTO notifications (
    user_id, notification_type, title, message,
    related_entity_type, related_entity_id,
    is_read, metadata
) VALUES (
    provider_id,
    'withdrawal_completed',
    '‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
    '‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 900 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô 10%)',
    'withdrawal',
    withdrawal_id,
    false,
    jsonb_build_object(
        'amount', 900.00,
        'commission', 100.00,
        'transfer_ref', 'TXN123456',
        'slip_url', 'https://storage.../masked.jpg'
    )
);
```

---

## üíº GOD Commission Tracking

### Commission Balance Tracking

```sql
-- ‡πÄ‡∏û‡∏¥‡πà‡∏° table ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô GOD
CREATE TABLE god_commission_balance (
    balance_id SERIAL PRIMARY KEY,
    god_user_id INTEGER NOT NULL REFERENCES users(user_id),
    platform_bank_account_id INTEGER REFERENCES platform_bank_accounts(platform_bank_id),
    
    -- Balances
    total_commission_collected DECIMAL(12, 2) DEFAULT 0.00,  -- ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ
    total_transferred DECIMAL(12, 2) DEFAULT 0.00,            -- ‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡πÑ‡∏õ provider
    current_balance DECIMAL(12, 2) DEFAULT 0.00,              -- ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ GOD
    
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ‡πÄ‡∏û‡∏¥‡πà‡∏° trigger ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏¢‡∏≠‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
CREATE OR REPLACE FUNCTION update_god_commission_balance()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.status = 'completed' AND OLD.status != 'completed' THEN
        UPDATE god_commission_balance
        SET total_transferred = total_transferred + NEW.net_amount,
            current_balance = total_commission_collected - (total_transferred + NEW.net_amount),
            last_updated = NOW()
        WHERE platform_bank_account_id = NEW.platform_bank_account_id;
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_god_balance
AFTER UPDATE ON withdrawals
FOR EACH ROW
EXECUTE FUNCTION update_god_commission_balance();
```

**GOD Dashboard:**
- ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô‡∏£‡∏ß‡∏°
- ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
- ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
- Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ/‡∏†‡∏≤‡∏©‡∏µ

---

---

## üé® UI/UX Guidelines for Fee Display

### Provider Side (‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°)

**1. Provider Registration:**
```jsx
// Modal ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á account
<FeeNotificationModal>
  <Icon>‚ö†Ô∏è</Icon>
  <Title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</Title>
  
  <FeeBreakdown>
    <Fee>Payment Gateway (Stripe): 2.75%</Fee>
    <Fee>Platform Commission: 10.00%</Fee>
    <Divider />
    <TotalFee>‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°: 12.75%</TotalFee>
  </FeeBreakdown>
  
  <Example>
    <Label>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</Label>
    <Item>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢: 1,000 ‡∏ö‡∏≤‡∏ó</Item>
    <Item>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: 872.50 ‡∏ö‡∏≤‡∏ó</Item>
    <Item>‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°: 127.50 ‡∏ö‡∏≤‡∏ó</Item>
  </Example>
  
  <Checkbox>
    <Input type="checkbox" required />
    <Label>‡∏â‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 12.75%</Label>
  </Checkbox>
  
  <Button>‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠</Button>
</FeeNotificationModal>
```

**2. Provider Dashboard - Wallet:**
```jsx
<WalletCard>
  <Balance>
    <Label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡∏≠‡∏ô</Label>
    <Amount>872.50 ‡∏ö‡∏≤‡∏ó</Amount>
  </Balance>
  
  <FeeInfo>
    <Icon>‚ÑπÔ∏è</Icon>
    <Text>
      ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 12.75% ‡πÅ‡∏•‡πâ‡∏ß
      (Payment Gateway 2.75% + Platform 10%)
    </Text>
  </FeeInfo>
</WalletCard>
```

**3. Transaction History:**
```jsx
<TransactionItem>
  <Header>
    <Type>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á #12345</Type>
    <Date>14 ‡∏û.‡∏¢. 2568</Date>
  </Header>
  
  <AmountBreakdown>
    <Row>
      <Label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</Label>
      <Value>1,000.00 ‡∏ö‡∏≤‡∏ó</Value>
    </Row>
    <Row type="deduction">
      <Label>Payment Gateway (2.75%)</Label>
      <Value>-27.50 ‡∏ö‡∏≤‡∏ó</Value>
    </Row>
    <Row type="deduction">
      <Label>Platform Commission (10%)</Label>
      <Value>-100.00 ‡∏ö‡∏≤‡∏ó</Value>
    </Row>
    <Divider />
    <Row type="total">
      <Label>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</Label>
      <Value>872.50 ‡∏ö‡∏≤‡∏ó</Value>
    </Row>
  </AmountBreakdown>
</TransactionItem>
```

**4. Service Package Creation:**
```jsx
<PackageForm>
  <PriceInput>
    <Label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏à‡πà‡∏≤‡∏¢)</Label>
    <Input type="number" placeholder="1000" />
  </PriceInput>
  
  <FeeCalculator>
    <Row>
      <Label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢:</Label>
      <Value>1,000.00 ‡∏ö‡∏≤‡∏ó</Value>
    </Row>
    <Row>
      <Label>‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏£‡∏ß‡∏° (12.75%):</Label>
      <Value type="negative">-127.50 ‡∏ö‡∏≤‡∏ó</Value>
    </Row>
    <Row type="highlight">
      <Label>‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:</Label>
      <Value>872.50 ‡∏ö‡∏≤‡∏ó</Value>
    </Row>
  </FeeCalculator>
</PackageForm>
```

### Client Side (‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°)

**1. Service Package List:**
```jsx
<PackageCard>
  <Title>‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</Title>
  <Price>1,000 ‡∏ö‡∏≤‡∏ó</Price>  {/* ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏° ‡πÑ‡∏°‡πà‡∏°‡∏µ fee */}
  <Button>‡∏à‡∏≠‡∏á‡πÄ‡∏•‡∏¢</Button>
</PackageCard>
```

**2. Booking Checkout:**
```jsx
<CheckoutSummary>
  <Item>
    <Label>‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</Label>
    <Price>1,000 ‡∏ö‡∏≤‡∏ó</Price>
  </Item>
  <Divider />
  <Total>
    <Label>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</Label>
    <Amount>1,000 ‡∏ö‡∏≤‡∏ó</Amount>  {/* ‡πÑ‡∏°‡πà‡∏°‡∏µ +fee */}
  </Total>
  <Button>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</Button>
</CheckoutSummary>
```

---

## üìß Email Templates

### 1. Provider Registration Confirmation

```html
<EmailTemplate>
  <Header>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà SkillMatch</Header>
  
  <Body>
    <Greeting>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ [Provider Name],</Greeting>
    
    <Message>
      ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà SkillMatch! ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß
    </Message>
    
    <FeeNotification>
      <Icon>üí∞</Icon>
      <Title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</Title>
      
      <Text>
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏£‡∏ß‡∏° 12.75% ‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
      </Text>
      
      <FeeList>
        <Item>‚Ä¢ Payment Gateway (Stripe): 2.75%</Item>
        <Item>‚Ä¢ Platform Commission: 10.00%</Item>
      </FeeList>
      
      <Example>
        <Strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</Strong>
        <br/>
        ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢ 1,000 ‡∏ö‡∏≤‡∏ó ‚Üí ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 872.50 ‡∏ö‡∏≤‡∏ó
        <br/>
        (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 127.50 ‡∏ö‡∏≤‡∏ó)
      </Example>
    </FeeNotification>
    
    <CTA>
      <Button href="/dashboard">‡πÑ‡∏õ‡∏¢‡∏±‡∏á Dashboard</Button>
    </CTA>
  </Body>
  
  <Footer>SkillMatch Platform</Footer>
</EmailTemplate>
```

### 2. Booking Completed (Provider)

```html
<EmailTemplate>
  <Header>üéâ ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏´‡∏°‡πà!</Header>
  
  <Body>
    <Booking>
      <Label>Booking #12345</Label>
      <Date>14 ‡∏û.‡∏¢. 2568</Date>
    </Booking>
    
    <Breakdown>
      <Row>
        <Label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</Label>
        <Value>1,000.00 ‡∏ö‡∏≤‡∏ó</Value>
      </Row>
      <Row type="deduction">
        <Label>Payment Gateway (2.75%):</Label>
        <Value>-27.50 ‡∏ö‡∏≤‡∏ó</Value>
      </Row>
      <Row type="deduction">
        <Label>Platform Commission (10%):</Label>
        <Value>-100.00 ‡∏ö‡∏≤‡∏ó</Value>
      </Row>
      <Divider />
      <Row type="total">
        <Label>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:</Label>
        <Value>872.50 ‡∏ö‡∏≤‡∏ó</Value>
      </Row>
    </Breakdown>
    
    <Status>
      ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡∏≠‡∏ô‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô (21 ‡∏û.‡∏¢. 2568)
    </Status>
  </Body>
</EmailTemplate>
```

---

## üî¢ Database Updates for Fee Calculation

**Update commission_rules table:**
```sql
-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å 10% ‡πÄ‡∏õ‡πá‡∏ô 12.75%
UPDATE commission_rules
SET platform_rate = 0.1000,           -- Platform Commission 10%
    payment_gateway_rate = 0.0275,    -- Stripe 2.75%
    description = 'Total fee: 12.75% (Platform 10% + Payment Gateway 2.75%)'
WHERE rule_id = 1;

-- ‡πÄ‡∏û‡∏¥‡πà‡∏° field ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö total_rate
ALTER TABLE commission_rules
ADD COLUMN IF NOT EXISTS total_rate DECIMAL(5, 4) GENERATED ALWAYS AS (platform_rate + payment_gateway_rate) STORED;

COMMENT ON COLUMN commission_rules.total_rate IS '‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (auto-calculated)';
```

**Update calculation logic:**
```sql
-- Function ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ provider
CREATE OR REPLACE FUNCTION calculate_provider_earning(booking_amount DECIMAL)
RETURNS TABLE (
    gross_amount DECIMAL,
    stripe_fee DECIMAL,
    platform_commission DECIMAL,
    total_fee DECIMAL,
    net_amount DECIMAL
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        booking_amount,                           -- ‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡πá‡∏°
        booking_amount * 0.0275,                  -- Stripe 2.75%
        booking_amount * 0.1000,                  -- Platform 10%
        booking_amount * 0.1275,                  -- ‡∏£‡∏ß‡∏° 12.75%
        booking_amount * 0.8725;                  -- Provider ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 87.25%
END;
$$ LANGUAGE plpgsql;

-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
SELECT * FROM calculate_provider_earning(1000.00);
-- Result:
-- gross_amount | stripe_fee | platform_commission | total_fee | net_amount
-- 1000.00      | 27.50      | 100.00              | 127.50    | 872.50
```

---

**Migrations:**  
- 013_add_financial_system.sql (Wallet, Transactions, Withdrawals)  
- 016_add_platform_bank_tracking.sql (Platform Bank Accounts, Transfer Logs)  
- 017_add_god_commission_tracking.sql (GOD Commission Balance)  
- 018_update_fee_structure.sql (Update to 12.75% total fee)

**Last Updated:** November 14, 2025  
**Status:** ‚úÖ Database Ready, üîÑ Implementation Needed:
- Update commission calculation to 12.75%
- Add provider registration fee notification
- Update dashboard to show net amount (after 12.75% fee)
- Hide fee information from client-facing pages
- Slip masking logic
- WebSocket notification on withdrawal completion
- Email notification with masked slip
